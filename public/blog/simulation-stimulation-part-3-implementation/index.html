<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.1.0">
  <meta name="generator" content="Hugo 0.54.0" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Joshua White">

  
  
  
    
  
  <meta name="description" content="All the nitty gritty details left out from Parts 1 and 2">

  
  <link rel="alternate" hreflang="en-us" href="/blog/simulation-stimulation-part-3-implementation/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="goldenrod">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Notable|Roboto:400,400italic,700|Roboto+Mono|Montserrat|Bowlby+One+SC|Russo+One">
  

  <link rel="stylesheet" href="/styles.css">
  
    
    
    
    
      
    
    
    
    <link rel="stylesheet" href="/css/academic.e43141f7d76978f7a85a4c644cb5f0ef.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="The New Golden Hammer">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="The New Golden Hammer">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/blog/simulation-stimulation-part-3-implementation/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@J_P_White">
  <meta property="twitter:creator" content="@J_P_White">
  
  <meta property="og:site_name" content="The New Golden Hammer">
  <meta property="og:url" content="/blog/simulation-stimulation-part-3-implementation/">
  <meta property="og:title" content="Simulation Stimulation Part 3: Implementation.  | The New Golden Hammer">
  <meta property="og:description" content="All the nitty gritty details left out from Parts 1 and 2"><meta property="og:image" content="/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-04-12T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-04-13T00:17:46&#43;10:00">
  

  

  

  <title>Simulation Stimulation Part 3: Implementation.  | The New Golden Hammer</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" class="dark">
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">The New Golden Hammer</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#aboutblog">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/blog/">
            
            <span>Blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Biography</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Simulation Stimulation Part 3: Implementation. </h1>

  

  
    



<meta content="2019-04-12 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2019-04-13 00:17:46 &#43;1000 AEST" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    <time>13 Apr, 2019</time>
  </span>
  

  

  

  
  
  <span class="middot-divider"></span>
  <a href="/blog/simulation-stimulation-part-3-implementation/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/r/">R</a>
    
  </span>
  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Simulation%20Stimulation%20Part%203%3a%20Implementation.%20&amp;url=%2fblog%2fsimulation-stimulation-part-3-implementation%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fblog%2fsimulation-stimulation-part-3-implementation%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fblog%2fsimulation-stimulation-part-3-implementation%2f&amp;title=Simulation%20Stimulation%20Part%203%3a%20Implementation.%20"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fblog%2fsimulation-stimulation-part-3-implementation%2f&amp;title=Simulation%20Stimulation%20Part%203%3a%20Implementation.%20"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Simulation%20Stimulation%20Part%203%3a%20Implementation.%20&amp;body=%2fblog%2fsimulation-stimulation-part-3-implementation%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    















  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<div id="TOC">
<ul>
<li><a href="#normal-and-poisson-models">Normal and Poisson models</a><ul>
<li><a href="#preparatory-steps">Preparatory steps</a></li>
<li><a href="#possion-model-simulations">Possion model simulations</a></li>
<li><a href="#normal-model-simulations">Normal model simulations</a></li>
</ul></li>
<li><a href="#rankings-model-tanh">Rankings Model: Tanh</a></li>
<li><a href="#postscript-how-are-my-models-fairing-so-far">Postscript: How are my models fairing so far?</a></li>
</ul>
</div>

<p>Parts 1 and 2 of this series made attempts to model, and them simulate, the 2018 and 2019 AFL seasons. These models were extremely simplistic, but were none-the-less interesting.</p>
<div id="normal-and-poisson-models" class="section level1">
<h1>Normal and Poisson models</h1>
<div id="preparatory-steps" class="section level2">
<h2>Preparatory steps</h2>
<pre class="r"><code>#average H or A
Average &lt;- pointssummary %&gt;% group_by(HorA, FororAgainst) %&gt;% summarise(Points = mean(Points)) 
Homeaveragefor &lt;- as.numeric(Average[4, 3])
Homeaverageagainst &lt;- as.numeric(Average[3, 3])
Awayaveragefor &lt;- as.numeric(Average[2, 3])
Awayaverageagainst &lt;- as.numeric(Average[1, 3])

####Get strengths####
# create functions to get Strenths
AttackstrengthH &lt;- function(T){
  as.numeric((pointssummary %&gt;% 
                filter(Team == T, HorA == &quot;H&quot;, FororAgainst == &quot;For&quot;) %&gt;%
                select(Points))/Homeaveragefor)
}

AttackstrengthA &lt;- function(T){
  as.numeric((pointssummary %&gt;% 
                filter(Team == T, HorA == &quot;A&quot;, FororAgainst == &quot;For&quot;) %&gt;% 
                select(Points))/Awayaveragefor)
}

DefencestrengthH &lt;- function(T){
  as.numeric(Homeaverageagainst/(pointssummary %&gt;% 
                                   filter(Team == T, HorA == &quot;H&quot;, FororAgainst == &quot;Against&quot;) %&gt;% 
                                   select(Points)))
}

DefencestrengthA &lt;-function(T){
  as.numeric(Awayaverageagainst/(pointssummary %&gt;% 
                                   filter(Team == T, HorA == &quot;A&quot;, FororAgainst == &quot;Against&quot;) %&gt;%
                                   select(Points)))
}

#get table with all strengths
#create tibble
strengths &lt;- tibble(Team = unique(pointssummary$Team), AstrengthH = NA, 
                    AstrengthA = NA, DstrengthH = NA, DstrengthA = NA)

# populate with strengths
strengths$AstrengthH &lt;- map_dbl(strengths$Team, AttackstrengthH)
strengths$AstrengthA &lt;- map_dbl(strengths$Team, AttackstrengthA)
strengths$DstrengthH &lt;- map_dbl(strengths$Team, DefencestrengthH)
strengths$DstrengthA &lt;- map_dbl(strengths$Team, DefencestrengthA)

####calculate paramater values: lambda and sd####
lambdas.2019 &lt;- add_column(fixture2019, homelambda = NA, homesd = NA, awaylambda = NA, awaysd = NA)

#create lambda  and sd functions
lambdahometeam &lt;- function(HomeTeam, AwayTeam) {
  Hometeamattackstrength &lt;- as.numeric(strengths[strengths$Team == HomeTeam, &quot;AstrengthH&quot;])
  Awayteamdefencestrength &lt;- as.numeric(strengths[strengths$Team == AwayTeam, &quot;DstrengthA&quot;])
  return(Homeaveragefor * Hometeamattackstrength / Awayteamdefencestrength)
}

lambdaawayteam &lt;- function(AwayTeam, HomeTeam) {
  Awayteamattackstrength &lt;- as.numeric(strengths[strengths$Team == AwayTeam, &quot;AstrengthA&quot;])
  Hometeamdefencestrength &lt;- as.numeric(strengths[strengths$Team == HomeTeam, &quot;DstrengthH&quot;])
  return(Awayaveragefor * Awayteamattackstrength / Hometeamdefencestrength)
}

sdhometeam &lt;- function(HomeTeam, AwayTeam) {
  Hometeamattack &lt;- as.numeric(pointssummary %&gt;% filter(Team == HomeTeam, HorA == &quot;H&quot;, FororAgainst == &quot;For&quot;) %&gt;%
                                 select(sd))
  Awayteamdefence &lt;- as.numeric(pointssummary %&gt;% filter(Team == AwayTeam, HorA == &quot;A&quot;, FororAgainst == &quot;Against&quot;) %&gt;%
                                  select(sd))
  # becuase n is equal can simply take average.
  return(mean(Hometeamattack, Awayteamdefence))
}

sdawayteam &lt;- function(AwayTeam, HomeTeam) {
  Awayteamattack &lt;- as.numeric(pointssummary %&gt;% filter(Team == AwayTeam, HorA == &quot;A&quot;, FororAgainst == &quot;For&quot;) %&gt;%
                                 select(sd))
  Hometeamdefence &lt;- as.numeric(pointssummary %&gt;%  filter(Team == HomeTeam, HorA == &quot;H&quot;, FororAgainst == &quot;Against&quot;) %&gt;%
                                  select(sd))
  # becuase n is equal can simply take average.
  return(mean(Awayteamattack, Hometeamdefence))
}

#populate lamba values 
for (i in 1:nrow(lambdas.2019)) {
  lambdas.2019$homelambda[i] &lt;- lambdahometeam(lambdas.2019$Hometeam[i], lambdas.2019$Awayteam[i])
  lambdas.2019$awaylambda[i] &lt;- lambdaawayteam(lambdas.2019$Awayteam[i], lambdas.2019$Hometeam[i])
  lambdas.2019$homesd[i] &lt;- sdhometeam(lambdas.2019$Hometeam[i], lambdas.2019$Awayteam[i])
  lambdas.2019$awaysd[i] &lt;- sdawayteam(lambdas.2019$Awayteam[i], lambdas.2019$Hometeam[i])
}</code></pre>
</div>
<div id="possion-model-simulations" class="section level2">
<h2>Possion model simulations</h2>
<pre class="r"><code>####POISSON SIMULATION####
Nsim.pois.2019 &lt;- 10

#set up simulation results table
SimResults &lt;- matrix(data = 0, nrow = Nsim.pois.2019, ncol = 18)
colnames(SimResults) &lt;- strengths$Team

for (i in 1:Nsim.pois.2019){
  
  #create Ladder for each season
  Ladder &lt;- tibble(Team = strengths$Team, W = 0, L = 0, D = 0, Pts = 0,
                   For = 0, Against = 0, Pct = 0)
  
  #simulate each season.
  for (j in 1:nrow(lambdas.2019)) {
    
    #Here is the model working -- each score is simply a random drawing 
    #from a poisson distribution described by our calculated lambas
    homescore &lt;- rpois(1, lambdas.2019$homelambda[j])
    awayscore &lt;- rpois(1, lambdas.2019$awaylambda[j])
    hometeam &lt;- lambdas.2019$Hometeam[j]
    awayteam &lt;- lambdas.2019$Awayteam[j]
    
    #populate scores
    Ladder[Ladder$Team == hometeam,]$For &lt;- Ladder[Ladder$Team == hometeam,]$For + homescore
    Ladder[Ladder$Team == hometeam,]$Against &lt;- Ladder[Ladder$Team == hometeam,]$Against + awayscore 
    Ladder[Ladder$Team == awayteam,]$For &lt;- Ladder[Ladder$Team == awayteam,]$For + awayscore
    Ladder[Ladder$Team == awayteam,]$Against &lt;- Ladder[Ladder$Team == awayteam,]$Against + homescore
    
    #populate table for draw
    if (homescore == awayscore) {
      #hometeam changes
      Ladder[Ladder$Team == hometeam,]$D &lt;- Ladder[Ladder$Team == hometeam,]$D + 1
      
      #awayteam changes
      Ladder[Ladder$Team == awayteam,]$D &lt;- Ladder[Ladder$Team == awayteam,]$D + 1
      
      #populate table for hometeam win
    } else if (homescore &gt; awayscore) {
      #hometeam changes
      Ladder[Ladder$Team == hometeam,]$W &lt;- Ladder[Ladder$Team == hometeam,]$W + 1
      
      #awayteam changes
      Ladder[Ladder$Team == awayteam,]$L &lt;- Ladder[Ladder$Team == awayteam,]$L + 1
      
      #populate for away team win
    } else {
      #hometeam changes
      Ladder[Ladder$Team == hometeam,]$L &lt;- Ladder[Ladder$Team == hometeam,]$L + 1
      
      #awayteam changes
      Ladder[Ladder$Team == awayteam,]$W &lt;- Ladder[Ladder$Team == awayteam,]$W + 1
    }
    
  }
  
  #calculate points and percentage and order final table
  #note that under AFL rules, if points are equal then ranked by percentage
  Ladder$Pct &lt;- Ladder$For / Ladder$Against * 100
  Ladder$Pts &lt;- (Ladder$W * 4) + (Ladder$D * 2)
  FinalLadder &lt;- Ladder %&gt;% arrange(desc(Pts), desc(Pct))
  
  #populate simulation results table
  for (k in 1:nrow(FinalLadder)) {
    SimResults[i, FinalLadder$Team[k]] &lt;- k
  }
} 

#Print and inspect results of Simulations
SimResultspois.2019 &lt;- as_tibble(SimResults)


#Make table summarising results of simulation
Finalsimtable &lt;- cbind.data.frame(MeanPos = colMeans(SimResultspois.2019),
                                  MedianPos = apply(SimResultspois.2019, 2, median),
                                  BestPos = apply(SimResultspois.2019, 2, min),
                                  WorstPos = apply(SimResultspois.2019, 2, max),
                                  percentWon =  apply(SimResultspois.2019 == 1, 2, sum)/nrow(SimResultspois.2019)*100,
                                  percentTop4 = apply(SimResultspois.2019 &lt;= 4, 2, sum)/nrow(SimResultspois.2019)*100,
                                  percentTop8 = apply(SimResultspois.2019 &lt;= 8, 2, sum)/nrow(SimResultspois.2019)*100,
                                  percentBottom4 = apply(SimResultspois.2019 &gt; 14, 2, sum)/nrow(SimResultspois.2019)*100,
                                  percentLast = apply(SimResultspois.2019 == 18, 2, sum)/nrow(SimResultspois.2019)*100) %&gt;%
  cbind.data.frame(Team = strengths$Team) 

Finalsimtablepois.2019 &lt;- Finalsimtable[,c(10, 2, 1, 3:9)] %&gt;% arrange(MedianPos, MeanPos)</code></pre>
</div>
<div id="normal-model-simulations" class="section level2">
<h2>Normal model simulations</h2>
<pre class="r"><code>####NORM SIMULATIONS####
Nsim.norm.2019 &lt;- 10

#set up simulation results table
SimResults &lt;- matrix(data = 0, nrow = Nsim.norm.2019, ncol = 18)
colnames(SimResults) &lt;- strengths$Team

for (i in 1:Nsim.norm.2019){
  
  #create Ladder for each season
  Ladder &lt;- tibble(Team = strengths$Team, W = 0, L = 0, D = 0, Pts = 0,
                   For = 0, Against = 0, Pct = 0)
  
  #simulate each season.
  for (j in 1:nrow(lambdas.2019)) {
    
    #Here is the model working -- each score is simply a random drawing 
    #from a normal dist characterised by our lambda as mean, and sd
    homescore &lt;- rnorm(1, mean = lambdas.2019$homelambda[j], sd = lambdas.2019$homesd[j])
    awayscore &lt;- rnorm(1, lambdas.2019$awaylambda[j], sd = lambdas.2019$awaysd[j])
    hometeam &lt;- lambdas.2019$Hometeam[j]
    awayteam &lt;- lambdas.2019$Awayteam[j]
    
    #populate scores
    Ladder[Ladder$Team == hometeam,]$For &lt;- Ladder[Ladder$Team == hometeam,]$For + homescore
    Ladder[Ladder$Team == hometeam,]$Against &lt;- Ladder[Ladder$Team == hometeam,]$Against + awayscore 
    Ladder[Ladder$Team == awayteam,]$For &lt;- Ladder[Ladder$Team == awayteam,]$For + awayscore
    Ladder[Ladder$Team == awayteam,]$Against &lt;- Ladder[Ladder$Team == awayteam,]$Against + homescore
    
    #populate table for draw
    if (homescore == awayscore) {
      #hometeam changes
      Ladder[Ladder$Team == hometeam,]$D &lt;- Ladder[Ladder$Team == hometeam,]$D + 1
      
      #awayteam changes
      Ladder[Ladder$Team == awayteam,]$D &lt;- Ladder[Ladder$Team == awayteam,]$D + 1
      
      #populate table for hometeam win
    } else if (homescore &gt; awayscore) {
      #hometeam changes
      Ladder[Ladder$Team == hometeam,]$W &lt;- Ladder[Ladder$Team == hometeam,]$W + 1
      
      #awayteam changes
      Ladder[Ladder$Team == awayteam,]$L &lt;- Ladder[Ladder$Team == awayteam,]$L + 1
      
      #populate for away team win
    } else {
      #hometeam changes
      Ladder[Ladder$Team == hometeam,]$L &lt;- Ladder[Ladder$Team == hometeam,]$L + 1
      
      #awayteam changes
      Ladder[Ladder$Team == awayteam,]$W &lt;- Ladder[Ladder$Team == awayteam,]$W + 1
    }
    
  }
  
  #calculate points and percentage and order final table
  #note that under AFL rules, if points are equal then ranked by percentage
  Ladder$Pct &lt;- Ladder$For / Ladder$Against * 100
  Ladder$Pts &lt;- (Ladder$W * 4) + (Ladder$D * 2)
  FinalLadder &lt;- Ladder %&gt;% arrange(desc(Pts), desc(Pct))
  
  #populate simulation results table
  for (k in 1:nrow(FinalLadder)) {
    SimResults[i, FinalLadder$Team[k]] &lt;- k
  }
} 

#Print and inspect results of Simulation
SimResultsnorm.2019 &lt;- as_tibble(SimResults)


#Make tabe summarising results of simulation
Finalsimtable.2019 &lt;- cbind.data.frame(MeanPos = colMeans(SimResultsnorm.2019),
                                  MedianPos = apply(SimResultsnorm.2019, 2, median),
                                  BestPos = apply(SimResultsnorm.2019, 2, min),
                                  WorstPos = apply(SimResultsnorm.2019, 2, max),
                                  percentWon =  apply(SimResultsnorm.2019 == 1, 2, sum)/nrow(SimResultsnorm.2019)*100,
                                  percentTop4 = apply(SimResultsnorm.2019 &lt;= 4, 2, sum)/nrow(SimResultsnorm.2019)*100,
                                  percentTop8 = apply(SimResultsnorm.2019 &lt;= 8, 2, sum)/nrow(SimResultsnorm.2019)*100,
                                  percentBottom4 = apply(SimResultsnorm.2019 &gt; 14, 2, sum)/nrow(SimResultsnorm.2019)*100,
                                  percentLast = apply(SimResultsnorm.2019 == 18, 2, sum)/nrow(SimResultsnorm.2019)*100) %&gt;%
  cbind.data.frame(Team = strengths$Team)

Finalsimtablenorm.2019 &lt;- Finalsimtable[,c(10, 2, 1, 3:9)] %&gt;% arrange(MedianPos, MeanPos)</code></pre>
</div>
</div>
<div id="rankings-model-tanh" class="section level1">
<h1>Rankings Model: Tanh</h1>
<pre class="r"><code>####TANH MODEL SIMULATIONS####
#set some params and functions
drawrate &lt;- 7 / (198*5)
drawparam &lt;- atanh(-drawrate)
probwin &lt;- function(a, b, w, d = drawparam){
  return((tanh(((a - b)/w) + d) + 1)/ 2)}

# reverse ladder order to get rankings needed for the model
rankings &lt;- rev(finalTable2018$Team)

##SIMULATIONS## 
Nsim.tanh.2019 &lt;- 10 # for each weight parameter looped over
w &lt;- 20
#create table for each simulation
gameresults.tanh &lt;- matrix(data = 0, nrow = Nsim.tanh.2019, ncol = nrow(fixture2019))

#initilise lists
gameresultslist&lt;- list()
SimResultsList.2019 &lt;- list()
Finalsimlist.2019 &lt;- list()

#loop over weight factor 
  for (i in 1:nrow(fixture2019)) {
    PW &lt;- probwin(match(fixture2019[i, 1], rankings),
                  match(fixture2019[i, 2], rankings), 
                  w)
    PL &lt;- probwin(match(fixture2019[i, 2], rankings),
                  match(fixture2019[i, 1], rankings), 
                  w)
    PD &lt;- 1 - PW - PL 
    gameresults.tanh[,i] &lt;- sample(x = c(&quot;W&quot;, &quot;L&quot;, &quot;D&quot;), size = Nsim.tanh.2019, replace = TRUE, prob = c(PW, PL, PD))
  }
  
  gameresultslist[[w]] &lt;- gameresults.tanh
  
  #create sim results
  SimResults &lt;- matrix(data = 0, nrow = Nsim.tanh.2019, ncol = 18)
  colnames(SimResults) &lt;- strengths$Team
  
  for (i in 1:nrow(gameresults.tanh)) {
    
    #create the ladder for each season.
    Ladder &lt;- tibble(Team = Ladder$Team, W = 0, L = 0, D = 0, Pts = 0)
    
    for (j in 1:ncol(gameresults.tanh)){
      
      hometeam.tanh &lt;- as.character(fixture2019[j,1])
      awayteam.tanh &lt;- as.character(fixture2019[j,2])
      
      if(gameresultslist[[w]][i,j] == &quot;W&quot;) {  
        Ladder[Ladder$Team == hometeam.tanh,]$W &lt;- Ladder[Ladder$Team == hometeam.tanh,]$W + 1 
        Ladder[Ladder$Team == awayteam.tanh,]$L &lt;- Ladder[Ladder$Team == awayteam.tanh,]$L + 1
        
      } else if (gameresultslist[[w]][i,j] == &quot;L&quot;) {
        Ladder[Ladder$Team == hometeam.tanh,]$L &lt;- Ladder[Ladder$Team == hometeam.tanh,]$L + 1
        Ladder[Ladder$Team == awayteam.tanh,]$W &lt;- Ladder[Ladder$Team == awayteam.tanh,]$W + 1 
        
      } else {
        Ladder[Ladder$Team == hometeam.tanh,]$D &lt;- Ladder[Ladder$Team == hometeam.tanh,]$D + 1
        Ladder[Ladder$Team == awayteam.tanh,]$D &lt;- Ladder[Ladder$Team == awayteam.tanh,]$D + 1
        
      }
      
    } 
    
    #calculate points and percentage and order final table
    #note that under AFL rules, if points are equal then ranked by percentage
    Ladder$Pts &lt;- (Ladder$W * 4) + (Ladder$D * 2)
    FinalLadder &lt;- Ladder %&gt;% arrange(desc(Pts), desc(rankings))
    
    #populate simulation results table
    for (k in 1:nrow(FinalLadder)) {
      SimResults[i, FinalLadder$Team[k]] &lt;- k
      SimResultsList.2019[[w]] &lt;- SimResults

    }
    
  }
  
  #Make tabe summarising results of simulation
  Finalsimtabletanh &lt;- cbind.data.frame(MeanPos = colMeans(SimResultsList.2019[[w]]),
                                        MedianPos = apply(SimResultsList.2019[[w]], 2, median),
                                        BestPos = apply(SimResultsList.2019[[w]], 2, min),
                                        WorstPos = apply(SimResultsList.2019[[w]], 2, max),
                                        percentWon =  apply(SimResultsList.2019[[w]] == 1, 2, sum)/nrow(SimResultsList.2019[[w]])*100,
                                        percentTop4 = apply(SimResultsList.2019[[w]] &lt;= 4, 2, sum)/nrow(SimResultsList.2019[[w]])*100,
                                        percentTop8 = apply(SimResultsList.2019[[w]] &lt;= 8, 2, sum)/nrow(SimResultsList.2019[[w]])*100,
                                        percentBottom4 = apply(SimResultsList.2019[[w]] &gt; 14, 2, sum)/nrow(SimResultsList.2019[[w]])*100,
                                        percentLast = apply(SimResultsList.2019[[w]] == 18, 2, sum)/nrow(SimResultsList.2019[[w]])*100) %&gt;%
    cbind.data.frame(Team = strengths$Team)  
  
  Finalsimtabletanh &lt;- Finalsimtabletanh[,c(10, 2, 1, 3:9)] %&gt;% arrange(MedianPos, MeanPos)
  Finalsimlist.2019[[w]] &lt;- Finalsimtabletanh</code></pre>
</div>
<div id="postscript-how-are-my-models-fairing-so-far" class="section level1">
<h1>Postscript: How are my models fairing so far?</h1>
<p>We are now 4 weeks into the 22 week AFL season, and the models are not looking so good. THis is really quite unsurprising — The first few weeks of the AFL season are always a tumultous time. Here</p>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/afl/">AFL</a>
  
  <a class="badge badge-light" href="/tags/simulations/">Simulations</a>
  
  <a class="badge badge-light" href="/tags/sport/">Sport</a>
  
</div>




    
      






  







      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/blog/simulation-stimulation-part-2-afl-season-2019/">Simulation Stimulation Part 2: AFL Season 2019</a></li>
          
          <li><a href="/blog/simulation-stimulation-afl-season-2018/">Simulation Stimulation: AFL Season 2018</a></li>
          
        </ul>
      </div>
      
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "newgoldenhammer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    Joshua White &copy; 2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    
    <script id="dsq-count-scr" src="//newgoldenhammer.disqus.com/count.js" async></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.d7381f2d79e6271d4da28f474f49096c.js"></script>

  </body>
</html>

